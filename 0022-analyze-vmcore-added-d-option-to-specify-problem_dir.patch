From 41fba6dcca95f8988ab7d8882f47de8766126ac1 Mon Sep 17 00:00:00 2001
From: Jiri Moskovcak <jmoskovc@redhat.com>
Date: Thu, 23 Feb 2012 21:12:47 +0100
Subject: [PATCH 022/105] analyze-vmcore: added -d option to specify
 problem_dir

---
 src/plugins/abrt-action-analyze-vmcore.in | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/plugins/abrt-action-analyze-vmcore.in b/src/plugins/abrt-action-analyze-vmcore.in
index 8441cc8..4adcf38 100644
--- a/src/plugins/abrt-action-analyze-vmcore.in
+++ b/src/plugins/abrt-action-analyze-vmcore.in
@@ -26,11 +26,11 @@ if __name__ == "__main__":
     vmlinux_di_cachedir = ""
     vmlinux_di_path = ""
     tmpdir = ""
-    vmcore = os.path.join(os.getcwd(), "vmcore")
+    vmcore = ""
     global verbose
     help_text = _("Usage: {0} [-v[v]] [--core=VMCORE] [--tmpdir=TMPDIR] [--cache=CACHEDIR]").format(PROGNAME)
     try:
-        opts, args = getopt.getopt(sys.argv[1:], "hv", ["help", "tmpdir=", "cache=", "core="])
+        opts, args = getopt.getopt(sys.argv[1:], "hvd", ["help", "tmpdir=", "cache=", "core="])
     except getopt.GetoptError, err:
         error_msg(err) # prints something like "option -a not recognized"
         error_msg_and_die(help_text)
@@ -49,7 +49,14 @@ if __name__ == "__main__":
             vmcore = arg
         elif opt == "--tmpdir":
             tmpdir = arg
+        elif opt in ("-d"):
+            try:
+                os.chdir(arg)
+            except OSError, ex:
+                print str(ex)
+                sys.exit(RETURN_FAILURE)
 
+    vmcore = os.path.join(os.getcwd(), "vmcore")
     set_verbosity(verbose)
     if not os.path.exists(vmcore):
         print _("File {0} doesn't exist").format(vmcore)
-- 
1.7.11.2

