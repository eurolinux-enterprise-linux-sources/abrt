From 87a55b3f93d61a789f5538cb5e0937e80ea78398 Mon Sep 17 00:00:00 2001
From: Martin Milata <mmilata@redhat.com>
Date: Tue, 13 Mar 2012 15:59:32 +0100
Subject: [PATCH 062/105] Don't download debuginfo for pkgs without build ids

Fixes rhbz#712950
---
 src/plugins/abrt-action-analyze-core | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/plugins/abrt-action-analyze-core b/src/plugins/abrt-action-analyze-core
index 54ddda9..0526211 100644
--- a/src/plugins/abrt-action-analyze-core
+++ b/src/plugins/abrt-action-analyze-core
@@ -96,7 +96,6 @@ def extract_info_from_core(coredump_name):
     # using set ensures the unique values
     build_ids = set()
     libraries = set()
-    build_ids = set()
 
     for line in lines:
         b_ids_line = line.split()
@@ -107,12 +106,13 @@ def extract_info_from_core(coredump_name):
             # See https://bugzilla.redhat.com/show_bug.cgi?id=706969
             # "Please split kernel debuginfo packages so that VDSO debuginfos are separate" -
             # we might want to remove this special-casing later.
-            if b_ids_line[EXECUTABLE] not in ["linux-vdso.so.1", "linux-gate.so.1"]:
+            if b_ids_line[BUILD_ID] == '-':
+                log(_("Missing build id: %s" % b_ids_line[EXECUTABLE]))
+            elif (b_ids_line[EXECUTABLE] not in ["linux-vdso.so.1", "linux-gate.so.1"]):
                 build_id = b_ids_line[BUILD_ID].split('@')[0]
                 build_ids.add(build_id)
                 library = b_ids_line[LIBRARY]
                 libraries.add(library)
-                build_ids.add(build_id)
             else:
                 log2("skipping line '%s'" % line)
     log1("Found %i build_ids" % len(build_ids))
-- 
1.7.11.2

