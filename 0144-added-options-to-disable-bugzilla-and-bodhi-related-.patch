From 1e4fce1a1b0cea50065995da067e6c8072e50c72 Mon Sep 17 00:00:00 2001
From: Jiri Moskovcak <jmoskovc@redhat.com>
Date: Tue, 12 Mar 2013 10:59:00 +0100
Subject: [ABRT EL6 PATCH 144/197] added options to disable bugzilla and bodhi
 related to: rhbz#828673 rhbz#810309

Signed-off-by: Jiri Moskovcak <jmoskovc@redhat.com>
Signed-off-by: Jakub Filak <jfilak@redhat.com>
---
 src/plugins/abrt-action-analyze-ccpp-local | 30 +++++++++++++++++++++++-------
 1 file changed, 23 insertions(+), 7 deletions(-)

diff --git a/src/plugins/abrt-action-analyze-ccpp-local b/src/plugins/abrt-action-analyze-ccpp-local
index fee0db1..0b02684 100755
--- a/src/plugins/abrt-action-analyze-ccpp-local
+++ b/src/plugins/abrt-action-analyze-ccpp-local
@@ -1,11 +1,23 @@
 #!/bin/sh
 
 INSTALL_DI=true
+WITH_BODHI=true
+# if bz is set to false it also disables bodhi, because it needs it's result
+WITH_BUGZILLA=true
 for opt in "$@"; do
     if [ x"$opt" = x"--without-di" ]; then
         INSTALL_DI=false
-    fi;
+    fi
+
+    if [ x"$opt" = x"--without-bz" ]; then
+        WITH_BUGZILLA=false
+    fi
+
+    if [ x"$opt" = x"--without-bodhi" ]; then
+        WITH_BODHI=false
+    fi
 done
+
 if $INSTALL_DI; then
     # On some systems debuginfo install needs root privileges.
     # Running a suided-to-abrt wrapper would make
@@ -20,11 +32,15 @@ fi
 
 if [ $? = 0 ]; then
     abrt-action-generate-backtrace &&
-    abrt-action-analyze-backtrace &&
-    (
-        bug_id=$(reporter-bugzilla -h "`cat duphash`") &&
-        if test -n "$bug_id"; then
-            abrt-bodhi -r -b $bug_id
+    abrt-action-analyze-backtrace
+    if [ "$?" == "0" ]; then
+        if $WITH_BUGZILLA; then
+            bug_id=$(reporter-bugzilla -h "`cat duphash`")
+            if $WITH_BODHI; then
+                if test -n "$bug_id"; then
+                    abrt-bodhi -r -b $bug_id
+                fi
+            fi
         fi
-    )
+    fi
 fi
-- 
1.8.2.1

